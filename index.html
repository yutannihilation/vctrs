<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vector Helpers • vctrs</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Vector Helpers">
<meta property="og:description" content="Functions that help you work with vectors, particularly numeric.
    Provides a full set of summary, cumulative, rolling, and vectorised
    functions for both R and C.">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">vctrs</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/s3-vector.html">S3 vectors</a>
    </li>
    <li>
      <a href="articles/theory.html">vctrs theory</a>
    </li>
    <li>
      <a href="articles/vctrs-vs-base.html">vctrs vs base</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-lib/vctrs">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="vctrs" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#vctrs" class="anchor"></a>vctrs <img src="reference/figures/logo.png" align="right" width="120" height="139" alt="">
</h1></div>

<p>The short-term goal of vctrs specify the behavior of functions that combine different types of vectors. This will help reason about functions that combine different types of input (e.g. <code>c()</code>, <code>ifelse()</code>, <code>rbind()</code>). The vctrs type system encompasses base vectors (e.g. logical, numeric, character, list), S3 vectors (e.g. factor, ordered, Date, POSIXct), and data frames; and can be extended to deal with S3 vectors defined in other packages, as described in <code>vignette("s3-vectors")</code>.</p>
<p>Understanding and extending vctrs requires some effort from developers, but it is our hope that the package will be invisible to most users. Having an underlying theory that describes what type of thing a function should return will mean that you can build up an accurate mental model from day-to-day use, and you will be less surprised by new functions.</p>
<p>In the longer-term, vctrs will become the home for tidyverse vector functions that work with logical and numeric vectors, and vectors in general. This will make it a natural complement to <a href="https://stringr.tidyverse.org">stringr</a> (strings), <a href="http://lubridate.tidyverse.org">lubridate</a> (date/times), and <a href="https://forcats.tidyverse.org">forcats</a> (factors), and will bring together various helpers that are currently scattered across packages, <code>ggplot2::cut_number()</code>, <code>dplyr::coalesce()</code>, and <code>tidyr::fill()</code>. In the very long-term, vctrs might provide the basis for a <a href="https://en.wikipedia.org/wiki/Type_system">type system</a> for vectors that could help automate documentation and argument checking.</p>
<p>vctrs has few dependencies and is suitable for use from other packages. (vctrs has a transitional dependency on tibble. Once vctrs is extensible all tibble related code will move into the tibble package.)</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>vctrs is not currently on CRAN. Install the development version from GitHub with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># install.packages("devtools")</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"r-lib/vctrs"</span>)</a></code></pre></div>
</div>
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p>The primary motivation comes from two separate, but related problems. The first problem is that <code><a href="http://www.rdocumentation.org/packages/base/topics/c">base::c()</a></code> has rather undesirable behaviour when you mix different S3 vectors:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># combining factors makes integers</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">c</span>(<span class="kw">factor</span>(<span class="st">"a"</span>), <span class="kw">factor</span>(<span class="st">"b"</span>))</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; [1] 1 1</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co"># even if you combine with a string</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="kw">c</span>(<span class="st">"a"</span>, <span class="kw">factor</span>(<span class="st">"a"</span>))</a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; [1] "a" "1"</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co"># combing dates and date-times give incorrect values</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">dt &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">"2020-01-1"</span>)</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">dttm &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(dt)</a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="kw">c</span>(dt, dttm)</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; [1] "2020-01-01"    "4321940-06-07"</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="kw">c</span>(dttm, dt)</a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; [1] "2020-01-01 00:00:00 UTC" "1970-01-01 05:04:22 UTC"</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co"># as do combining dates and factors</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="kw">c</span>(dt, <span class="kw">factor</span>(<span class="st">"a"</span>))</a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt; [1] "2020-01-01" "1970-01-02"</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="kw">c</span>(<span class="kw">factor</span>(<span class="st">"a"</span>), dt)</a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; [1]     1 18262</span></a></code></pre></div>
<p>This behaviour arises because <code>c()</code> has dual purposes: as well as it’s primary duty of combining vectors, it has a secondary duty of stripping attributes. For example, <code>?POSIXct</code> suggests that you should use <code>c()</code> if you want to reset the timezone. A detailed comparison of vctrs vs base R behaviour can be found in <code>vignettes("vctrs-vs-base.Rmd")</code></p>
<p>The second problem is that <code>dplyr::bind_rows()</code> is not extensible by others. Currently, it handles arbitrary S3 classes using heuristics, but these often fail, and it feels like we really need to think through the problem in order to build a principled solution. This intersects with the need to cleanly support more types of data frame columns including lists of data frames, data frames, and matrices.</p>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(vctrs)</a></code></pre></div>
<div id="base-vectors" class="section level3">
<h3 class="hasAnchor">
<a href="#base-vectors" class="anchor"></a>Base vectors</h3>
<p><code><a href="reference/vec_c.html">vec_c()</a></code> works like <code>c()</code>, but has stricter coercion rules:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="reference/vec_c.html">vec_c</a></span>(<span class="ot">TRUE</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; [1] 1 1</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="reference/vec_c.html">vec_c</a></span>(1L, <span class="fl">1.5</span>)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; [1] 1.0 1.5</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw"><a href="reference/vec_c.html">vec_c</a></span>(<span class="fl">1.5</span>, <span class="st">"x"</span>)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; Error: No common type for double and character</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; Backtrail:</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;  ─withCallingHandlers(...)</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;  ─vec_c(1.5, "x")</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;  ─vec_ptype(!!!args, .ptype = .ptype)</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;  ─reduce(ptypes, vec_type2, .init = unknown())</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt;  ─Reduce(f, .x, init = .init)</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt;  ─f(init, x[[i]])</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt;  ─vec_type2.double.default(x, y, ...)</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt;  ─stop_incompatible_type(x, y)</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt;  ─stop_incompatible(...)</span></a></code></pre></div>
<p>Unlike <code>c()</code>, you can optionally specify the desired output class by supplying a <strong>prototype</strong>, or ptype, for short:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="reference/vec_c.html">vec_c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">.ptype =</span> <span class="kw">integer</span>())</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; [1] 1 2</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw"><a href="reference/vec_c.html">vec_c</a></span>(<span class="dv">1</span>, <span class="st">"x"</span>, <span class="dt">.ptype =</span> <span class="kw">character</span>())</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; [1] "1" "x"</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw"><a href="reference/vec_c.html">vec_c</a></span>(<span class="dv">1</span>, <span class="st">"x"</span>, <span class="dt">.ptype =</span> <span class="kw">list</span>())</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; [1] "x"</span></a></code></pre></div>
<p>This supports a much wider range of casts (more on that below) than the automatic coercions, but it can still fail:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="reference/vec_c.html">vec_c</a></span>(<span class="kw">Sys.Date</span>(), <span class="dt">.ptype =</span> <span class="kw">factor</span>())</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; Error: Can't cast date to factor&lt;&gt;</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; Backtrail:</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt;  ─withCallingHandlers(...)</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt;  ─vec_c(Sys.Date(), .ptype = factor())</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt;  ─vec_cast.factor.default(args[[i]], to = ptype)</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt;  ─stop_incompatible_cast(x, to)</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt;  ─stop_incompatible(...)</span></a></code></pre></div>
</div>
<div id="what-is-a-prototype" class="section level3">
<h3 class="hasAnchor">
<a href="#what-is-a-prototype" class="anchor"></a>What is a prototype?</h3>
<p>Internally, vctrs represents the class of a vector with a 0-length subset. We call this a prototype, because it’s a miniature version of the vector, that contains all of the attributes but none of the data. Conveniently, you can create many prototypes using existing base functions (e.g, <code>double()</code>, <code>factor(levels = c("a", "b"))</code>).</p>
<p>You can use <code><a href="reference/vec_ptype.html">vec_ptype()</a></code> to create a prototype from an existing object. It has a print method that summarises the prototype:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(letters)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; prototype: character</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; prototype: integer</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; prototype: list</span></a></code></pre></div>
<p>Some protoypes have parameters that affect their behaviour. These are displayed where possible:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># Factors display a hash of their levels; this lets</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co"># you distinguish different factors at a glance</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">factor</span>(<span class="st">"a"</span>))</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; prototype: factor&lt;127a2&gt;</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">factor</span>(<span class="st">"b"</span>))</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; prototype: factor&lt;ddf10&gt;</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co"># Date-times display their timezone</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">Sys.time</span>())</a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; prototype: datetime&lt;local&gt;</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co"># difftimes display their units</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">as.difftime</span>(<span class="dv">10</span>, <span class="dt">units =</span> <span class="st">"mins"</span>))</a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; prototype: time&lt;mins&gt;</span></a></code></pre></div>
<p>vctrs provides the <code><a href="reference/unknown.html">unknown()</a></code> class to represent vectors of unknown type:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>()</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; prototype: unknown</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; prototype: unknown</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co"># NA is technically logical, but used in many places to</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co"># represent a missing value of arbitrary type</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt; prototype: unknown</span></a></code></pre></div>
</div>
<div id="coercion-and-casting" class="section level3">
<h3 class="hasAnchor">
<a href="#coercion-and-casting" class="anchor"></a>Coercion and casting</h3>
<p>vctrs defines the relationship between classes with two functions: <code><a href="reference/vec_type2.html">vec_type2()</a></code> and <code><a href="reference/vec_cast.html">vec_cast()</a></code>. <code><a href="reference/vec_type2.html">vec_type2()</a></code> is used for implicit coercions: given two classes, it returns the common class if it exists, or otherwise throws and error. <code><a href="reference/vec_type2.html">vec_type2()</a></code> is commutative, associative, and has an identity element, <code><a href="reference/unknown.html">unknown()</a></code>.</p>
<p>The easiest way to explore coercion is to give multiple arguments to <code><a href="reference/vec_ptype.html">vec_ptype()</a></code>. It uses <code><a href="reference/vec_type2.html">vec_type2()</a></code> to find the common type and displays the results in a convenient form:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">integer</span>(), <span class="kw">double</span>())</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; prototype: double</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">Sys.Date</span>(), <span class="kw">Sys.time</span>())</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; prototype: datetime&lt;local&gt;</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co"># no common type</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">factor</span>(), <span class="kw">Sys.Date</span>())</a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; Error: No common type for factor&lt;&gt; and date</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; Backtrail:</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt;  ─withCallingHandlers(...)</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt;  ─vec_ptype(factor(), Sys.Date())</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt;  ─reduce(ptypes, vec_type2, .init = unknown())</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt;  ─Reduce(f, .x, init = .init)</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt;  ─f(init, x[[i]])</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt;  ─vec_type2.factor.default(x, y, ...)</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt;  ─stop_incompatible_type(x, y)</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt;  ─stop_incompatible(...)</span></a></code></pre></div>
<p><code><a href="reference/vec_cast.html">vec_cast()</a></code> is used for explicit casts: given a value and a class, it casts the value to the class or throws an error stating that the cast is not possible. If a cast is possible in general (i.e. double -&gt; integer), but information is lost for a specific input (e.g. 1.5 -&gt; 1), it will generate a warning.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># Cast succeeds</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="reference/vec_cast.html">vec_cast</a></span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="kw">integer</span>())</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; [1] 1 2</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co"># Cast loses information</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="kw"><a href="reference/vec_cast.html">vec_cast</a></span>(<span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">2.5</span>), <span class="kw">integer</span>())</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; Warning: Lossy cast from double to integer</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt; Locations: 1, 2</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; [1] 1 2</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co"># Cast fails</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="kw"><a href="reference/vec_cast.html">vec_cast</a></span>(<span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">2.5</span>), <span class="kw">factor</span>(<span class="st">"a"</span>))</a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; Error: Can't cast double to factor&lt;127a2&gt;</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; Backtrail:</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt;  ─withCallingHandlers(...)</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt;  ─vec_cast.factor.default(c(1.5, 2.5), factor("a"))</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt;  ─stop_incompatible_cast(x, to)</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt;  ─stop_incompatible(...)</span></a></code></pre></div>
<p>The set of possible casts is a subset of possible automatic coercions. The following diagram summarises both casts (arrows) and coercions (circles) for all base types supported by vctrs:</p>
<p><img src="reference/figures/combined.png"></p>
</div>
<div id="factors" class="section level3">
<h3 class="hasAnchor">
<a href="#factors" class="anchor"></a>Factors</h3>
<p>Note that the commutativity of <code><a href="reference/vec_type2.html">vec_type2()</a></code> only applies to the prototype, not the attributes of the prototype. Concretely, the order in which you concatenate factors will affect the order of the levels in the output:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">fa &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="st">"a"</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">fb &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="st">"b"</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="kw">levels</span>(<span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(fa, fb)[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt; [1] "a" "b"</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="kw">levels</span>(<span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(fb, fa)[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt; [1] "b" "a"</span></a></code></pre></div>
</div>
<div id="matrices-and-arrays" class="section level3">
<h3 class="hasAnchor">
<a href="#matrices-and-arrays" class="anchor"></a>Matrices and arrays</h3>
<p>Any bare vector can have a <code>dim</code> attribute which turns it into a matrix or array. The prototype of a matrix or array its a 0-row subset.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">array</span>(<span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co">#&gt; prototype: double[,10]</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">array</span>(<span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">#&gt; prototype: double[,10,10]</span></a></code></pre></div>
<p>A pair of arrays only has common type if the dimensions match:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">array</span>(<span class="ot">TRUE</span>, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>)), <span class="kw">array</span>(<span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="co">#&gt; prototype: double[,10]</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">array</span>(<span class="ot">TRUE</span>, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>)), <span class="kw">array</span>(<span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#&gt; Error: No common type for logical[,10] and double[,1]</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">#&gt; Shapes are not compatible</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt; Backtrail:</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">#&gt;  ─withCallingHandlers(...)</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt;  ─vec_ptype(array(TRUE, c(2, 10)), array(1, c(5, 1)))</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt;  ─reduce(ptypes, vec_type2, .init = unknown())</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt;  ─Reduce(f, .x, init = .init)</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt;  ─f(init, x[[i]])</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt;  ─vec_type2.logical.double(x, y, ...)</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt;  ─dim_match(double(), x, y)</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt;  ─dim_common(x, y)</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">#&gt;  ─stop_incompatible_type(x, y, details = "Shapes are not compatible")</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">#&gt;  ─stop_incompatible(...)</span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(<span class="kw">array</span>(<span class="ot">TRUE</span>, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>)), <span class="kw">array</span>(<span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">#&gt; Error: No common type for logical[,10] and double[,10,1]</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"><span class="co">#&gt; Dimensionality must be equal</span></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="co">#&gt; Backtrail:</span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="co">#&gt;  ─withCallingHandlers(...)</span></a>
<a class="sourceLine" id="cb14-23" data-line-number="23"><span class="co">#&gt;  ─vec_ptype(array(TRUE, c(2, 10)), array(1, c(5, 10, 1)))</span></a>
<a class="sourceLine" id="cb14-24" data-line-number="24"><span class="co">#&gt;  ─reduce(ptypes, vec_type2, .init = unknown())</span></a>
<a class="sourceLine" id="cb14-25" data-line-number="25"><span class="co">#&gt;  ─Reduce(f, .x, init = .init)</span></a>
<a class="sourceLine" id="cb14-26" data-line-number="26"><span class="co">#&gt;  ─f(init, x[[i]])</span></a>
<a class="sourceLine" id="cb14-27" data-line-number="27"><span class="co">#&gt;  ─vec_type2.logical.double(x, y, ...)</span></a>
<a class="sourceLine" id="cb14-28" data-line-number="28"><span class="co">#&gt;  ─dim_match(double(), x, y)</span></a>
<a class="sourceLine" id="cb14-29" data-line-number="29"><span class="co">#&gt;  ─dim_common(x, y)</span></a>
<a class="sourceLine" id="cb14-30" data-line-number="30"><span class="co">#&gt;  ─stop_incompatible_type(x, y, details = "Dimensionality must be equal")</span></a>
<a class="sourceLine" id="cb14-31" data-line-number="31"><span class="co">#&gt;  ─stop_incompatible(...)</span></a></code></pre></div>
</div>
<div id="data-frames" class="section level3">
<h3 class="hasAnchor">
<a href="#data-frames" class="anchor"></a>Data frames</h3>
<p>Data frames are defined by the names and prototypes of their columns:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="ot">TRUE</span>, <span class="dt">y =</span> 1L)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(df1)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co">#&gt; prototype: data.frame&lt;</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">#&gt;   x: logical</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">#&gt;   y: integer</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="co">#&gt; &gt;</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"></a>
<a class="sourceLine" id="cb15-8" data-line-number="8">df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">z =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(df2)</a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">#&gt; prototype: data.frame&lt;</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt;   x: double</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="co">#&gt;   z: double</span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#&gt; &gt;</span></a></code></pre></div>
<p>The common type of two data frames is the common type of each column that occurs in both data frame frames, and the union of the columns that only occur in one:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(df1, df2)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co">#&gt; prototype: data.frame&lt;</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">#&gt;   x: double</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">#&gt;   y: integer</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#&gt;   z: double</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">#&gt; &gt;</span></a></code></pre></div>
<p>Like factors, the order of variables in the data frame is not commutative, and depends on the order of the inputs:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(df1, df2)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co">#&gt; prototype: data.frame&lt;</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">#&gt;   x: double</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co">#&gt;   y: integer</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co">#&gt;   z: double</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co">#&gt; &gt;</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(df2, df1)</a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt; prototype: data.frame&lt;</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt;   x: double</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt;   z: double</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt;   y: integer</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt; &gt;</span></a></code></pre></div>
<p>Data frames are interesting because they are recursive: a data frame can have a column that is also a data frame. vctrs knows how to handle these too:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">df3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> 2L)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">df3<span class="op">$</span>a &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="dv">2</span>, <span class="dt">b =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(df3)</a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="co">#&gt; prototype: data.frame&lt;</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="co">#&gt;   x: integer</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="co">#&gt;   a: </span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt;     data.frame&lt;</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#&gt;       a: double</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt;       b: double</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt;     &gt;</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#&gt; &gt;</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"></a>
<a class="sourceLine" id="cb18-13" data-line-number="13">df4 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb18-14" data-line-number="14">df4<span class="op">$</span>a &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="ot">FALSE</span>, <span class="dt">b =</span> <span class="dv">3</span>, <span class="dt">c =</span> <span class="st">"a"</span>)</a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(df4)</a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="co">#&gt; prototype: data.frame&lt;</span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="co">#&gt;   x: double</span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="co">#&gt;   a: </span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="co">#&gt;     data.frame&lt;</span></a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="co">#&gt;       a: logical</span></a>
<a class="sourceLine" id="cb18-21" data-line-number="21"><span class="co">#&gt;       b: double</span></a>
<a class="sourceLine" id="cb18-22" data-line-number="22"><span class="co">#&gt;       c: factor&lt;127a2&gt;</span></a>
<a class="sourceLine" id="cb18-23" data-line-number="23"><span class="co">#&gt;     &gt;</span></a>
<a class="sourceLine" id="cb18-24" data-line-number="24"><span class="co">#&gt; &gt;</span></a>
<a class="sourceLine" id="cb18-25" data-line-number="25"></a>
<a class="sourceLine" id="cb18-26" data-line-number="26"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(df3, df4)</a>
<a class="sourceLine" id="cb18-27" data-line-number="27"><span class="co">#&gt; prototype: data.frame&lt;</span></a>
<a class="sourceLine" id="cb18-28" data-line-number="28"><span class="co">#&gt;   x: double</span></a>
<a class="sourceLine" id="cb18-29" data-line-number="29"><span class="co">#&gt;   a: </span></a>
<a class="sourceLine" id="cb18-30" data-line-number="30"><span class="co">#&gt;     data.frame&lt;</span></a>
<a class="sourceLine" id="cb18-31" data-line-number="31"><span class="co">#&gt;       a: double</span></a>
<a class="sourceLine" id="cb18-32" data-line-number="32"><span class="co">#&gt;       b: double</span></a>
<a class="sourceLine" id="cb18-33" data-line-number="33"><span class="co">#&gt;       c: factor&lt;127a2&gt;</span></a>
<a class="sourceLine" id="cb18-34" data-line-number="34"><span class="co">#&gt;     &gt;</span></a>
<a class="sourceLine" id="cb18-35" data-line-number="35"><span class="co">#&gt; &gt;</span></a></code></pre></div>
</div>
<div id="list-of" class="section level3">
<h3 class="hasAnchor">
<a href="#list-of" class="anchor"></a>List of</h3>
<p>vctrs provides a new class that represents a list of elements with constant prototype but varying lengths. This is an interesting contrast to a data frame which is a list of elements with constant length, but varying prototypes.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">x1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/list_of.html">list_of</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">8</span>)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(x1)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#&gt; prototype: list_of&lt;integer&gt;</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co"># This type is enforced if you attempt to modify the vector</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">x1[[<span class="dv">4</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">#&gt; Error: Invalid index: out of bounds</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8">x1[[<span class="dv">4</span>]]</a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">#&gt; Error: Invalid index: out of bounds</span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"></a>
<a class="sourceLine" id="cb19-11" data-line-number="11">x1[[<span class="dv">5</span>]] &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="st">"x"</span>)</a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="co">#&gt; Error: Can't cast factor&lt;5a425&gt; to integer</span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13"><span class="co">#&gt; Backtrail:</span></a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="co">#&gt;  ─withCallingHandlers(...)</span></a>
<a class="sourceLine" id="cb19-15" data-line-number="15"><span class="co">#&gt;  ─`[[&lt;-.vctrs_list_of`(`*tmp*`, 5, value = structure(1L, .Label = "x", class = "factor"))</span></a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="co">#&gt;  ─vec_cast.integer.default(value, attr(x, "ptype"))</span></a>
<a class="sourceLine" id="cb19-17" data-line-number="17"><span class="co">#&gt;  ─stop_incompatible_cast(x, to)</span></a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="co">#&gt;  ─stop_incompatible(...)</span></a></code></pre></div>
<p>This provides a natural type for nested data frames:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">by_cyl &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cyl =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>))</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">by_cyl<span class="op">$</span>data &lt;-<span class="st"> </span><span class="kw"><a href="reference/list_of.html">as_list_of</a></span>(<span class="kw">split</span>(mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], mtcars<span class="op">$</span>cyl))</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="kw"><a href="reference/vec_ptype.html">vec_ptype</a></span>(by_cyl)</a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="co">#&gt; prototype: data.frame&lt;</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co">#&gt;   cyl : double</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co">#&gt;   data: </span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="co">#&gt;     list_of&lt;</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co">#&gt;       data.frame&lt;</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co">#&gt;         mpg : double</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="co">#&gt;         cyl : double</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="co">#&gt;         disp: double</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="co">#&gt;       &gt;</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="co">#&gt;     &gt;</span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="co">#&gt; &gt;</span></a></code></pre></div>
</div>
</div>
<div id="tidyverse-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#tidyverse-functions" class="anchor"></a>Tidyverse functions</h2>
<p>There are a number of tidyverse functions that currently need to do type coercion. In the long run, their varied and idiosyncratic approaches will be replaced by the systematic foundation provided by vctrs.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># Data frame functions</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">dplyr<span class="op">::</span><span class="kw">inner_join</span>() <span class="co"># and friends</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3">dplyr<span class="op">::</span><span class="kw">bind_rows</span>()</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">dplyr<span class="op">::</span><span class="kw">summarise</span>()</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">dplyr<span class="op">::</span><span class="kw">mutate</span>()</a>
<a class="sourceLine" id="cb21-6" data-line-number="6"></a>
<a class="sourceLine" id="cb21-7" data-line-number="7">tidyr<span class="op">::</span><span class="kw">gather</span>()</a>
<a class="sourceLine" id="cb21-8" data-line-number="8">tidyr<span class="op">::</span><span class="kw">unnest</span>()</a>
<a class="sourceLine" id="cb21-9" data-line-number="9"></a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="co"># Vector functions</span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11">purrr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/flatten">flatten</a></span>()</a>
<a class="sourceLine" id="cb21-12" data-line-number="12">purrr<span class="op">::</span><span class="kw">map_c</span>()</a>
<a class="sourceLine" id="cb21-13" data-line-number="13">purrr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/transpose">transpose</a></span>()</a>
<a class="sourceLine" id="cb21-14" data-line-number="14"></a>
<a class="sourceLine" id="cb21-15" data-line-number="15">dplyr<span class="op">::</span><span class="kw">combine</span>()</a>
<a class="sourceLine" id="cb21-16" data-line-number="16">dplyr<span class="op">::</span><span class="kw">if_else</span>()</a>
<a class="sourceLine" id="cb21-17" data-line-number="17">dplyr<span class="op">::</span><span class="kw">recode</span>()</a>
<a class="sourceLine" id="cb21-18" data-line-number="18">dplyr<span class="op">::</span><span class="kw">case_when</span>()</a>
<a class="sourceLine" id="cb21-19" data-line-number="19">dplyr<span class="op">::</span><span class="kw">coalesce</span>()</a>
<a class="sourceLine" id="cb21-20" data-line-number="20">dplyr<span class="op">::</span><span class="kw">na_if</span>()</a>
<a class="sourceLine" id="cb21-21" data-line-number="21">dplyr<span class="op">::</span><span class="kw">between</span>()</a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/r-lib/vctrs">https://​github.com/​r-lib/​vctrs</a>
</li>
<li>Report a bug at <br><a href="https://github.com/r-lib/vctrs/issues">https://​github.com/​r-lib/​vctrs/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="http://hadley.nz">Hadley Wickham</a> <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/r-lib/vctrs"><img src="https://travis-ci.org/r-lib/vctrs.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://codecov.io/github/r-lib/vctrs?branch=master"><img src="https://codecov.io/gh/r-lib/vctrs/branch/master/graph/badge.svg" alt="Coverage status"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="lifecycle"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://hadley.nz">Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
